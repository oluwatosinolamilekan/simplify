image: php:7.4

variables:
  MYSQL_DATABASE: addio_test
  MYSQL_ROOT_PASSWORD: ""
  DB_HOST: 127.0.0.1
  DB_USERNAME: root
  MYSQL_ALLOW_EMPTY_PASSWORD: "1"

before_script:
  - apt-get update && apt-get install -qq git curl libmcrypt-dev libjpeg-dev libpng-dev libfreetype6-dev libbz2-dev zip libzip-dev
  - apt-get clean
  - pecl install mcrypt
  - docker-php-ext-enable mcrypt
  - docker-php-ext-install pdo_mysql zip
  - curl --silent --show-error "https://getcomposer.org/installer" | php -- --install-dir=/usr/local/bin --filename=composer
  - cp .env.cypress .env
  - composer install  
  - php artisan env
  - cat .env
  - mysql -h 127.0.0.1 -u root -e 'SELECT VERSION()'
  
services:
  - mysql:8.0.25




stages:
  - test

unit_test:
  stage: test
  script:
    - php artisan test
